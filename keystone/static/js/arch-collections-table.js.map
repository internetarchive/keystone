{"version":3,"file":"arch-collections-table.js","sources":["../../../../../web-components/src/archCollectionsTable/src/styles.ts","../../../../../web-components/src/archCollectionsTable/src/arch-collections-table.ts"],"sourcesContent":["import { css } from \"lit\";\n\nexport default [\n  css`\n    data-table > table {\n      table-layout: fixed;\n    }\n\n    data-table > table > thead > tr > th.type {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th.dataset-date {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th.size {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th {\n      max-width: none;\n    }\n  `,\n];\n","import { PropertyValues } from \"lit\";\nimport { customElement } from \"lit/decorators.js\";\n\nimport { ArchDataTable } from \"../../archDataTable/index\";\nimport { CollectionTypeDisplayMap } from \"../../lib/constants\";\nimport {\n  Collection,\n  CollectionType,\n  CustomCollectionMetadata,\n  SpecialCollectionMetadata,\n  ProcessingState,\n  ValueOf,\n} from \"../../lib/types\";\nimport { Topics } from \"../../lib/pubsub\";\nimport {\n  Paths,\n  createElement,\n  humanBytes,\n  isActiveProcessingState,\n  isValidCustomInputCollection,\n  isoStringToDateString,\n} from \"../../lib/helpers\";\nimport Styles from \"./styles\";\n\n@customElement(\"arch-collections-table\")\nexport class ArchCollectionsTable extends ArchDataTable<Collection> {\n  static styles = [...ArchDataTable.styles, ...Styles];\n\n  static renderNameCell(\n    name: ValueOf<Collection>,\n    collection: Collection\n  ): HTMLElement {\n    /*\n     * Render the `Name` cell element.\n     */\n    const nameSpan = createElement(\"span\", {\n      className: \"highlightable\",\n      textContent: collection.name,\n    });\n\n    if (\n      collection.collection_type === CollectionType.CUSTOM &&\n      (collection.metadata as CustomCollectionMetadata).state !==\n        ProcessingState.FINISHED\n    ) {\n      // Collection is an in-progress custom collection.\n      nameSpan.title =\n        \"This Custom collection is in the process of being created\";\n      const state = (collection.metadata as CustomCollectionMetadata).state;\n      const displayStatus =\n        state === ProcessingState.RUNNING ? \"CREATING\" : state;\n      nameSpan.appendChild(\n        createElement(\"i\", { textContent: ` (${displayStatus})` })\n      );\n      return nameSpan;\n    }\n\n    // Collection is not an in-progress custom collection.\n    return createElement(\"a\", {\n      href: `/collections/${collection.id}`,\n      title: collection.name,\n      children: [nameSpan],\n    });\n  }\n\n  static renderLatestDatasetCell(\n    lastJobName: ValueOf<Collection>,\n    collection: Collection\n  ): string | HTMLElement {\n    /*\n     * Render the `Latest Dataset` cell element.\n     */\n    return lastJobName === null\n      ? \"\"\n      : createElement(\"a\", {\n          href: Paths.dataset(collection.latest_dataset.id),\n          title: lastJobName.toString(),\n          textContent: lastJobName.toString(),\n        });\n  }\n\n  willUpdate(_changedProperties: PropertyValues) {\n    super.willUpdate(_changedProperties);\n\n    this.actionButtonLabels = [\"Generate Dataset\", \"Create Custom Collection\"];\n    this.actionButtonSignals = [\n      Topics.GENERATE_DATASET,\n      Topics.CREATE_SUB_COLLECTION,\n    ];\n    this.actionButtonDisabledTitles = [\n      \"Select a single collection below to generate a dataset\",\n      \"Select one or more of the Archive-It, Custom, or Special-type collections below to create a custom collection\",\n    ];\n    this.apiCollectionEndpoint = \"/collections\";\n    this.apiItemResponseIsArray = true;\n    this.apiItemTemplate = \"/collections?id=:id\";\n    this.itemPollPredicate = (item) =>\n      item.collection_type === CollectionType.CUSTOM\n        ? isActiveProcessingState(\n            (item.metadata as CustomCollectionMetadata).state\n          )\n        : false;\n    this.itemPollPeriodSeconds = 3;\n\n    this.cellRenderers = [\n      ArchCollectionsTable.renderNameCell,\n\n      (collectionType, collection) =>\n        ((collection?.metadata as SpecialCollectionMetadata)\n          ?.type_displayname as string | null) ||\n        CollectionTypeDisplayMap[collectionType as CollectionType],\n\n      ArchCollectionsTable.renderLatestDatasetCell,\n\n      (lastJobTime) =>\n        !lastJobTime ? \"\" : isoStringToDateString(lastJobTime as string),\n\n      (_, collection: Collection) =>\n        collection.collection_type === CollectionType.CUSTOM &&\n        (collection.metadata as CustomCollectionMetadata).state !==\n          ProcessingState.FINISHED\n          ? \"\"\n          : humanBytes(collection.size_bytes, 1),\n    ];\n\n    this.columns = [\n      \"name\",\n      \"collection_type\",\n      \"latest_dataset.name\",\n      \"latest_dataset.start_time\",\n      \"size_bytes\",\n    ];\n    this.columnHeaders = [\n      \"Name\",\n      \"Type\",\n      \"Latest Dataset\",\n      \"Dataset Date\",\n      \"Size\",\n    ];\n    this.rowSelectDisabledCallback = (row: Collection) => {\n      const metadata = row.metadata as CustomCollectionMetadata;\n      return metadata?.state && isActiveProcessingState(metadata.state);\n    };\n    this.selectable = true;\n    this.sort = \"-id\";\n    this.sortableColumns = [true, true, false, true, true];\n    this.filterableColumns = [false, true];\n    this.searchColumns = [\"name\"];\n    this.searchColumnLabels = [\"Name\"];\n    this.singleName = \"Collection\";\n    this.persistSearchStateInUrl = true;\n    this.pluralName = \"Collections\";\n  }\n\n  postSelectionChangeHandler(selectedRows: Array<Collection>) {\n    /* Update DataTable.actionButtonDisabled based on the number\n       of selected rows.\n    */\n    const { dataTable } = this;\n    const { props } = dataTable;\n    const numSelected = selectedRows.length;\n    const generateDatasetEnabled = numSelected === 1;\n    const createSubCollectionEnabled = selectedRows.every(\n      isValidCustomInputCollection\n    );\n    props.actionButtonDisabled = [\n      !generateDatasetEnabled,\n      !createSubCollectionEnabled,\n    ];\n    dataTable.setSelectionActionButtonDisabledState(numSelected === 0);\n  }\n\n  selectionActionHandler(action: string, selectedRows: Array<Collection>) {\n    switch (action) {\n      case Topics.GENERATE_DATASET:\n        window.location.href = Paths.generateCollectionDataset(\n          selectedRows[0].id\n        );\n        break;\n      case Topics.CREATE_SUB_COLLECTION:\n        window.location.href = Paths.buildSubCollection(\n          selectedRows.map((x) => x.id)\n        );\n    }\n  }\n}\n\n// Injects the tag into the global name space\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"arch-collections-table\": ArchCollectionsTable;\n  }\n}\n"],"names":["Styles","css","ArchCollectionsTable","ArchCollectionsTable_1","ArchDataTable","static","name","collection","nameSpan","createElement","className","textContent","collection_type","CollectionType","CUSTOM","metadata","state","ProcessingState","FINISHED","title","displayStatus","RUNNING","appendChild","href","id","children","lastJobName","Paths","dataset","latest_dataset","toString","willUpdate","_changedProperties","super","this","actionButtonLabels","actionButtonSignals","Topics","GENERATE_DATASET","CREATE_SUB_COLLECTION","actionButtonDisabledTitles","apiCollectionEndpoint","apiItemResponseIsArray","apiItemTemplate","itemPollPredicate","item","isActiveProcessingState","itemPollPeriodSeconds","cellRenderers","renderNameCell","collectionType","_a","type_displayname","CollectionTypeDisplayMap","renderLatestDatasetCell","lastJobTime","isoStringToDateString","_","humanBytes","size_bytes","columns","columnHeaders","rowSelectDisabledCallback","row","selectable","sort","sortableColumns","filterableColumns","searchColumns","searchColumnLabels","singleName","persistSearchStateInUrl","pluralName","postSelectionChangeHandler","selectedRows","dataTable","props","numSelected","length","generateDatasetEnabled","createSubCollectionEnabled","every","isValidCustomInputCollection","actionButtonDisabled","setSelectionActionButtonDisabledState","selectionActionHandler","action","window","location","generateCollectionDataset","buildSubCollection","map","x","styles","__decorate","customElement"],"mappings":"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"}